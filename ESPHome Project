esphome:
  name: filament-dryer-a
  friendly_name: Filament Dryer A

esp32:
  board: adafruit_feather_esp32s3_reversetft
  framework:
    type: esp-idf
#    type: arduino

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: "VDNOhmd4l4QV/aE56n3PYjMuZWVMpN0Pfngt56WKwO0="

ota:
  - platform: esphome
    password: "f4b1238b4a89e5fdc2a8b3cc3ed2f02b"

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Filament-Dryer-A"
    password: "fpOCGvGuClZd"

captive_portal:
    

# SPI setup
spi:
  clk_pin: GPIO36
  mosi_pin: GPIO35
  miso_pin: GPIO37


#i2c setup
i2c:
  - id: bus_a
    scan: true
    sda: GPIO3
    scl: GPIO4

#EMC2101 FAN CONTROLLER
#emc2101:
#  pwm:
#    resolution: 8
#BME680 
bme68x_bsec2_i2c:
  address: 0x76
  model: bme688
  operating_age: 4d
  sample_rate: LP
  #supply_voltage: 3.3V


sensor:
  - platform: bme68x_bsec2
    temperature:
      name: "Dryer Exhaust Temperature"
      id: "Temperature"
    pressure:
      name: "Dryer Exhaust Pressure"
    humidity:
      name: "Dryer Exhaust Humidity"
      id: "Humidity"
    gas_resistance:
      name: "Gas Resistance"
  - platform: pid
    name: "Heater PID %"
    type: HEAT
#  - platform: emc2101
#    internal_temperature:
#      id: internal_temperature_sensor
#      name: "Internal Temperature Sensor"
#    speed:
#      id: speed_sensor
#      name: "Speed Sensor"
#    duty_cycle:
#      id: duty_cycle_sensor
#      name: "Duty Cycle Sensor"
#    update_interval: 5s

binary_sensor:
  - platform: gpio
    pin: GPIO1
    name: "Button 1"
    id: Button_1
#    on_press:
#      then:
  - platform: gpio
    pin: GPIO0
    name: "Button 0"
    id: Button_0
#    on_press:
#      then:
  - platform: gpio
    pin: GPIO2
    name: "Button 2"
    id: Button_2
#    on_press:
#      then:        

#button:
#  - platform: template
#    name: "PID Climate Autotune"
#    on_press:
#      - climate.pid.autotune: Heater


output:
#  - platform: gpio
#    id: neopixel_power
#    pin: GPIO21
  - platform: slow_pwm
    id: Relay
    period: 12s
    max_power: .80
    min_power: 0
    pin: GPIO10
    
#    restart_cycle_on_state_change: True
#    state_change_action:
#      - light.toggle: "rgb"
#    turn_on_action:
#      - light.turn_on:
#          id: rgb
#          brightness: 100%
#          red: 100%
#          green: 54%
#          blue: 5%
#    turn_off_action:
#      - light.turn_on:
#          id: rgb      
#          brightness: 100%
#          red: 6%
#          green: 9%
#          blue: 100%
#      - delay: 500ms
#      - light.turn_off: "rgb"


#light:
#  - platform: esp32_rmt_led_strip
    
#    rgb_order: GRB
#    chipset: WS2812
#    pin: GPIO33
#    num_leds: 1
#    id: "rgb"
#    name: "rgb"


# power supply to tft
power_supply:
  - id: tft_pwr_en
    pin: GPIO7
    enable_on_boot: True

# display setup
#display:
#  - platform: st7789v
#    model: Custom #Adafruit S2 TFT FEATHER 240X135
#    backlight_pin: GPIO45
#    cs_pin: GPIO42
#    dc_pin: GPIO40
#    reset_pin: GPIO41
#    power_supply: tft_pwr_en
#    height: 240
#    width: 135
#    auto_clear_enabled: false
#    update_interval: never
#    offset_height: 52
#    offset_width: 40
#    lambda: |-
#      auto red = Color(255, 0, 0);
#      it.fill(red);


climate:
  - platform: pid
    name: "Heater"
    id: Heater
    sensor: Temperature
#    humidity_sensor: Humidity
    default_target_temperature: 40°C
    heat_output: Relay
    control_parameters:
      kp: 0.28916
      ki: 0.00418
      kd: 4.99831
      output_averaging_samples: 1      # smooth the output over 5 samples
      derivative_averaging_samples: 1  # smooth the derivative value over 10 samples
#    deadband_parameters:
#      threshold_high: 0.5°C
#      threshold_low: -1.0°C
#      kp_multiplier: 0.05   # proportional gain turned off inside deadband
#      ki_multiplier: 0.05  # integral accumulates at only 5% of normal ki
#      kd_multiplier: 0.0   # derviative is turned off inside deadband
#      deadband_output_averaging_samples: 2   # average the output over 15 samples within the deadband
    visual:
      min_temperature: 10
      max_temperature: 70
#    preset_command_topic: 



#lvgl:
#  encoders:
#    sensor:
#      left_button: Button_0
#      right_button: Button_2
#    enter_button: Button_1
#    long_press_time: 2s
#  widgets:
#    - label:
#        align: Center
#        text: 'Hello World!'

